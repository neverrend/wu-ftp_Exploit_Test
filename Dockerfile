FROM debian:latest

RUN apt-get update && apt-get install -y  gcc \
					make \  
					bison flex \
					ftp
COPY . /wu-ftpd

WORKDIR /wu-ftpd/wu-ftpd-2.6.0/
RUN ./configure
RUN mkdir /usr/man/
RUN mkdir /usr/man/man8 && cp ./doc/ftpd.8 /usr/man/man8
RUN mkdir /usr/man/man1 && cp ./doc/ftpcount.1 /usr/man/man1
RUN mkdir /usr/man/man5 && cp ./doc/ftpaccess.5 /usr/man/man5
RUN sed -i 's/\t=\t{/\t{/g' src/ftpcmd.y
RUN make && make install
RUN cp ../configs/* /etc/

RUN echo "ftp:*:400:400:Anonymous FTP:/home/ftp:/bin/tru" >> /etc/passwd
RUN echo "ftp:x:400:" >> /etc/group
RUN mkdir /home/ftp
RUN chmod 555 /home/ftp
RUN chown root:ftp /home/ftp
RUN mkdir /home/ftp/bin/
RUN chmod 111 /home/ftp/bin/

WORKDIR bin/
RUN cp ftpd /usr/sbin/

#EXPOSE 21
#CMD ["ftpd", "-s"]
