FROM debian:latest

RUN apt-get update && \
    apt-get install -y bison \
                       flex \
                       ftp \
                       gcc \
                       gdb \
                       make \
                       man \
                       vim

COPY configs/* /etc/
COPY wu-ftpd-2.6.0 /usr/src/wu-ftpd
WORKDIR /usr/src/wu-ftpd/

RUN ./configure --mandir="/usr/share/man" && \
    sed -i 's/\t=\t{/\t{/g' src/ftpcmd.y && \
    make && make install && \
    echo "ftp:*:400:400:Anonymous FTP:/home/ftp:/bin/tru" >> /etc/passwd && \
    echo "ftp:x:400:" >> /etc/group && \
    mkdir -p /home/ftp/bin && \
    chmod 555 /home/ftp && \
    chown root:ftp /home/ftp && \
    chmod 111 /home/ftp/bin

ENTRYPOINT ["/usr/src/wu-ftpd/bin/ftpd"]
CMD ["-S"]
